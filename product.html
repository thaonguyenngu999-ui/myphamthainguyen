<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chi tiết sản phẩm | Mỹ Phẩm Thái Nguyên</title>
  <meta id="metaDescription" name="description" content="Chi tiết sản phẩm tại Mỹ Phẩm Thái Nguyên." />
  <meta id="ogTitle" property="og:title" content="Chi tiết sản phẩm" />
  <meta id="ogDescription" property="og:description" content="Xem chi tiết sản phẩm và mua nhanh qua link affiliate." />
  <meta property="og:type" content="product" />
  <meta id="ogUrl" property="og:url" content="https://myphamthainguyen.github.io/product.html" />
  <meta id="ogImage" property="og:image" content="https://placehold.co/600x600?text=My+Pham" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta id="twitterTitle" name="twitter:title" content="Chi tiết sản phẩm" />
  <meta id="twitterDescription" name="twitter:description" content="Xem chi tiết sản phẩm và mua nhanh qua link affiliate." />
  <meta id="twitterImage" name="twitter:image" content="https://placehold.co/600x600?text=My+Pham" />
  <link id="canonicalLink" rel="canonical" href="product.html" />
  <script src="assets/js/seo-config.js?v=20260211"></script>
  <script src="assets/js/seo-global.js?v=20260211"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="assets/css/style.css?v=20260217" />
</head>
<body class="product-page">
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html">Mỹ Phẩm Thái Nguyên</a>
      <nav class="header-actions">
        <a href="index.html">Trang chu</a>
        <a href="admin.html">Dang ky / Dang nhap</a>
      </nav>
    </div>
  </header>

  <main class="container product-main">
    <nav class="product-breadcrumb">
      <a href="index.html">Trang chu</a>
      <span>/</span>
      <span id="breadcrumbCategory">Danh muc</span>
      <span>/</span>
      <span id="breadcrumbName">San pham</span>
    </nav>

    <section class="product-shell">
      <div class="detail-top">
        <div class="detail-media">
          <div class="detail-viewer product-gallery" id="productGallery">
            <button id="prevMediaBtn" class="viewer-nav prev" type="button" aria-label="Ảnh trước">
              <span class="material-icons" aria-hidden="true">chevron_left</span>
            </button>
            <button id="nextMediaBtn" class="viewer-nav next" type="button" aria-label="Ảnh sau">
              <span class="material-icons" aria-hidden="true">chevron_right</span>
            </button>
            <div class="viewer-image-slot" id="viewerImageSlot">
              <img class="gallery-img active" id="galleryImgA" src="" alt="" />
              <img class="gallery-img" id="galleryImgB" src="" alt="" />
            </div>
            <video id="viewerVideo" controls preload="metadata" playsinline muted loop class="hidden"></video>
            <button id="videoPlayOverlay" class="video-play-overlay hidden" type="button" aria-label="Phát video sản phẩm">
              <span class="material-icons" aria-hidden="true">play_arrow</span>
            </button>
          </div>
          <div id="viewerThumbs" class="detail-thumbs"></div>
        </div>

        <div class="detail-info">
          <h1 id="productName">Ten san pham</h1>
          <div class="detail-rating-row">
            <span id="productSold">Da ban 0</span>
            <span id="productCategory" class="category-pill"></span>
          </div>
          <div class="detail-price-row">
            <span id="productCurrentPrice" class="current-price"></span>
            <span id="productOldPrice" class="old-price"></span>
            <span id="productDiscount" class="detail-discount"></span>
          </div>
          <p id="productDescription" class="detail-short-desc"></p>

          <div class="product-actions">
            <button id="buyNowBtn" class="btn-buy-now" type="button" aria-label="Mua ngay sản phẩm">Mua ngay</button>
            <a class="btn-more back-btn" href="san-pham.html" aria-label="Xem thêm sản phẩm">Xem thêm sản phẩm</a>
          </div>
        </div>
      </div>

      <div class="detail-body">
        <h2>Mô tả sản phẩm</h2>
        <p id="productDetails" class="detail-long-desc"></p>
        <h2>Thông số nổi bật</h2>
        <ul id="productSpecs" class="detail-specs"></ul>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>© 2026 Mỹ Phẩm Thái Nguyên. Affiliate Shopee.</small>
    </div>
  </footer>

  <nav class="bottom-nav" role="navigation" aria-label="Điều hướng dưới">
    <a href="index.html" data-route="index.html /" aria-label="Trang chủ">
      <span class="material-icons" aria-hidden="true">home</span>
      <span class="label">Trang chủ</span>
    </a>
    <a href="san-pham.html" data-route="san-pham products" aria-label="Sản phẩm">
      <span class="material-icons" aria-hidden="true">shopping_bag</span>
      <span class="label">Sản phẩm</span>
    </a>
    <a href="sale.html" data-route="sale" aria-label="Sale" class="sale-item">
      <span class="material-icons" aria-hidden="true">local_fire_department</span>
      <span class="label">Sale</span>
    </a>
    <a href="index.html#menu" data-route="menu danh-muc category" aria-label="Menu danh mục">
      <span class="material-icons" aria-hidden="true">menu</span>
      <span class="label">Menu</span>
    </a>
  </nav>

  <script id="productJsonLd" type="application/ld+json">{}</script>
  <script src="assets/js/product.js?v=20260227" defer></script>
  <script>
    (function productInlineFallback() {
      function slugify(value) {
        return String(value || "")
          .replaceAll("đ", "d")
          .replaceAll("Đ", "d")
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "")
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/(^-|-$)/g, "");
      }
      function createProductSlug(value) {
        const base = slugify(value).slice(0, 60).replace(/-+$/g, "");
        return base || "san-pham";
      }
      function formatVnd(value) {
        return new Intl.NumberFormat("vi-VN", { style: "currency", currency: "VND" }).format(Number(value) || 0);
      }
      function getRouteSlug() {
        const params = new URLSearchParams(location.search);
        const querySlug = createProductSlug(params.get("slug") || "");
        const pathMatch = location.pathname.match(/\/san-pham\/([^/?#]+)/i);
        const pathSlug = pathMatch ? createProductSlug(decodeURIComponent(pathMatch[1] || "").replace(/\.html$/i, "")) : "";
        return pathSlug || querySlug;
      }
      var FALLBACK_IMG = "https://placehold.co/600x600?text=My+Pham";
      function normalizeProduct(item) {
        var imgs = Array.isArray(item.images) ? item.images.filter(Boolean) : [];
        if (!imgs.length && item.image) imgs = [item.image];
        if (!imgs.length) imgs = [FALLBACK_IMG];
        return {
          id: String(item.id || ""),
          slug: createProductSlug(item.slug || item.name || item.id || ""),
          name: String(item.name || "Sản phẩm"),
          image: String(imgs[0] || FALLBACK_IMG),
          images: imgs,
          videoUrl: String(item.videoUrl || item.video || ""),
          currentPrice: Number(item.currentPrice) || 0,
          oldPrice: Number(item.oldPrice) || 0,
          discount: Number(item.discount) || 0,
          affiliateLink: String(item.affiliateLink || "#"),
          description: String(item.description || "Đang cập nhật mô tả sản phẩm."),
          specs: Array.isArray(item.specs) ? item.specs.filter(Boolean) : [],
          details: String(item.details || item.longDescription || item.description || "")
        };
      }
      function shouldRunFallback() {
        const nameEl = document.getElementById("productName");
        if (!nameEl) return false;
        const name = String(nameEl.textContent || "").trim().toLowerCase();
        return !name || name === "ten san pham" || name.includes("không tìm thấy");
      }
      async function fetchProducts() {
        const candidates = [
          "/assets/data/products.json",
          "assets/data/products.json",
          "https://raw.githubusercontent.com/thaonguyenngu999-ui/myphamthainguyen/main/assets/data/products.json"
        ];
        for (const url of candidates) {
          try {
            const res = await fetch(url, { cache: "no-store" });
            if (!res.ok) continue;
            const data = await res.json();
            if (Array.isArray(data)) return data.map(normalizeProduct);
          } catch {
            // next source
          }
        }
        return [];
      }
      function renderNotFound() {
        const nameEl = document.getElementById("productName");
        const descEl = document.getElementById("productDescription");
        if (nameEl) nameEl.textContent = "Không tìm thấy sản phẩm";
        if (descEl) descEl.textContent = "Sản phẩm không tồn tại hoặc đã bị xóa.";
      }
      function getMediaList(product) {
        var media = (product.images || []).map(function (url) { return { type: "image", url: url }; });
        if (product.videoUrl) media.unshift({ type: "video", url: product.videoUrl });
        return media.length ? media : [{ type: "image", url: FALLBACK_IMG }];
      }

      function renderMediaGallery(product) {
        var imageSlot = document.getElementById("viewerImageSlot");
        var imgA = document.getElementById("galleryImgA");
        var imgB = document.getElementById("galleryImgB");
        var viewerVideo = document.getElementById("viewerVideo");
        var viewerThumbs = document.getElementById("viewerThumbs");
        var videoOverlay = document.getElementById("videoPlayOverlay");
        var prevBtn = document.getElementById("prevMediaBtn");
        var nextBtn = document.getElementById("nextMediaBtn");
        if (!imageSlot || !viewerThumbs || !imgA || !imgB) return;
        var mediaList = getMediaList(product);
        var idx = 0;
        var showNav = mediaList.length > 1;
        if (prevBtn) prevBtn.classList.toggle("hidden", !showNav);
        if (nextBtn) nextBtn.classList.toggle("hidden", !showNav);
        function setActive(i) {
          idx = (i + mediaList.length) % mediaList.length;
          mediaList.forEach(function (m, j) {
            var t = viewerThumbs.children[j];
            if (t) t.classList.toggle("active", j === idx);
          });
          var item = mediaList[idx];
          if (item.type === "video") {
            imageSlot.classList.add("hidden");
            if (viewerVideo) {
              viewerVideo.classList.remove("hidden");
              viewerVideo.muted = true;
              viewerVideo.loop = true;
              viewerVideo.playsInline = true;
              viewerVideo.setAttribute("playsinline", "");
              viewerVideo.setAttribute("muted", "");
              viewerVideo.poster = product.images && product.images[0] ? product.images[0] : FALLBACK_IMG;
              viewerVideo.src = item.url;
              viewerVideo.load();
              viewerVideo.play().then(function () {
                if (videoOverlay) videoOverlay.classList.add("hidden");
              }).catch(function () {
                if (videoOverlay) videoOverlay.classList.remove("hidden");
              });
              viewerVideo.onerror = function () {
                viewerVideo.classList.add("hidden");
                viewerVideo.src = "";
                if (videoOverlay) videoOverlay.classList.add("hidden");
                imageSlot.classList.remove("hidden");
                imgA.src = product.images && product.images[0] ? product.images[0] : FALLBACK_IMG;
                imgA.classList.add("active");
                imgB.classList.remove("active");
              };
            }
          } else {
            if (viewerVideo) {
              viewerVideo.pause();
              viewerVideo.classList.add("hidden");
              viewerVideo.src = "";
              if (videoOverlay) videoOverlay.classList.add("hidden");
            }
            imageSlot.classList.remove("hidden");
            var url = (item.url || FALLBACK_IMG) + ((item.url || "").indexOf("?") >= 0 ? "&" : "?") + "_=" + Date.now();
            var activeImg = imgA.classList.contains("active") ? imgA : imgB;
            var nextImg = activeImg === imgA ? imgB : imgA;
            nextImg.src = url;
            nextImg.alt = product.name;
            nextImg.onerror = function () { this.src = FALLBACK_IMG; this.onerror = null; };
            nextImg.classList.add("active");
            activeImg.classList.remove("active");
          }
        }
        viewerThumbs.innerHTML = "";
        mediaList.forEach(function (item, i) {
          var btn = document.createElement("button");
          btn.type = "button";
          btn.className = "thumb-item" + (i === 0 ? " active" : "");
          btn.dataset.index = String(i);
          if (item.type === "video") {
            btn.classList.add("thumb-video");
            btn.innerHTML = "<span class=\"thumb-video-icon\">&#9654;</span><span class=\"thumb-video-text\">Video</span>";
          } else {
            btn.innerHTML = "<img src=\"" + (item.url || "").replace(/"/g, "&quot;") + "\" alt=\"thumb\" loading=\"lazy\" tabindex=\"-1\" />";
          }
          btn.addEventListener("click", function (ev) {
            ev.preventDefault();
            ev.stopPropagation();
            var j = parseInt(this.dataset.index, 10);
            if (!isNaN(j)) setActive(j);
          });
          viewerThumbs.appendChild(btn);
        });
        if (prevBtn) prevBtn.onclick = function () { setActive(idx - 1); };
        if (nextBtn) nextBtn.onclick = function () { setActive(idx + 1); };
        setActive(0);
      }

      function renderProduct(product) {
        var nameEl = document.getElementById("productName");
        var currentEl = document.getElementById("productCurrentPrice");
        var oldEl = document.getElementById("productOldPrice");
        var discountEl = document.getElementById("productDiscount");
        var descEl = document.getElementById("productDescription");
        var detailEl = document.getElementById("productDetails");
        var specsEl = document.getElementById("productSpecs");
        var buyBtn = document.getElementById("buyNowBtn");
        if (nameEl) nameEl.textContent = product.name;
        renderMediaGallery(product);
        if (currentEl) currentEl.textContent = formatVnd(product.currentPrice);
        if (oldEl) oldEl.textContent = product.oldPrice ? formatVnd(product.oldPrice) : "";
        if (discountEl) discountEl.textContent = product.discount ? "-" + product.discount + "%" : "";
        if (descEl) descEl.textContent = product.description;
        if (detailEl) detailEl.textContent = product.details || product.description;
        if (specsEl) {
          var specs = product.specs.length
            ? product.specs
            : ["Thông tin chi tiết đang được cập nhật."];
          specsEl.innerHTML = specs.map(function (spec) {
            return "<li>" + String(spec).replaceAll("<", "&lt;").replaceAll(">", "&gt;") + "</li>";
          }).join("");
        }
        if (buyBtn) {
          buyBtn.classList.remove("hidden");
          buyBtn.onclick = function () {
            window.open(product.affiliateLink, "_blank", "noopener");
          };
        }
      }
      async function run() {
        if (!shouldRunFallback()) return;
        const slug = getRouteSlug();
        const id = String(new URLSearchParams(location.search).get("id") || "");
        const products = await fetchProducts();
        const product = products.find((item) => (
          (slug && item.slug === slug) ||
          (id && item.id === id) ||
          (slug && (item.slug.startsWith(slug) || slug.startsWith(item.slug)))
        ));
        if (!product) {
          renderNotFound();
          return;
        }
        renderProduct(product);
      }
      window.setTimeout(run, 700);
    }());
  </script>
</body>
</html>
